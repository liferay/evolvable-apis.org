<!DOCTYPE html><html><head><meta charset="UTF-8"><meta content="minimum-scale=1.0, width=device-width" name="viewport"><meta name="description" content=""><title>Resource embedding - Evolvable APIs</title><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Roboto+Mono"><link rel="stylesheet" href="/vendor/galano/galano.css"><link rel="stylesheet" href="/vendor/icon-12/icon-12.css"><link rel="stylesheet" href="/vendor/icon-16/icon-16.css"><link rel="stylesheet" href="/vendor/senna/senna.css"><link rel="stylesheet" href="/vendor/codemirror/lib/codemirror.css"><link rel="stylesheet" href="/vendor/codemirror/theme/dracula.css"><script src="/js/bundles/shared.electric.js"></script><script src="/vendor/senna/senna.js"></script><script src="/vendor/codemirror/lib/codemirror.js"></script><script src="/vendor/codemirror/mode/css/css.js"></script><script src="/vendor/codemirror/mode/xml/xml.js"></script><script src="/vendor/codemirror/mode/javascript/javascript.js"></script><link rel="stylesheet" href="/styles/main.css"></head><body data-senna=""><div data-senna-surface="" id="wrapper"><div class="senna-loading-bar"></div><div id="pageComponent"><div class="main"><main class="guide"><div class="docs"><nav class="topbar topbar-light topbar-docs"><div class="topbar-logo"><a class="topbar-logo-link" href="/"><span class="topbar-logo-icon icon-16-hammer"></span><h3 class="topbar-logo-text">Evolvable APIs</h3></a></div><nav class="topbar-menu"><button class="topbar-toggle">Menu</button><ul class="topbar-list"><li class="topbar-item"><a class="topbar-link topbar-link-selected" href="/docs/introduction/index.html" target="undefined"><span>Docs</span></a></li><li class="topbar-item"><a class="topbar-link " href="/updates/" target="undefined"><span>Updates</span></a></li></ul></nav></nav><div class="ribbon-container"><div class="ribbon ribbon-accent">Beta</div></div><nav class="sidebar"><a class="sidebar-header toggler-header-collapsed"><span class="sidebar-icon icon-16-menu"></span><span>Docs Menu</span><span class="sidebar-icon-right"><span class="icon-12-arrow-down-short"></span><span class="icon-12-arrow-up-short"></span></span></a><div class="sidebar-toggler-content toggler-collapsed"><div class="sidebar-search"><div class="page-autocomplete"><div class="form-group"><div class="input-inner-addon input-inner-addon-right"><input autocomplete="off" class="form-control" name="q" placeholder="Search Docs" ref="input" required="" type="text"><span class="input-inner-icon-helper icon-16-magnifier"></span></div></div></div></div><nav class=""><ul class="sidebar-list sidebar-list-1"><li class="sidebar-item"><a class="sidebar-link " href="/docs/introduction/"><span class="sidebar-icon icon-16-streams"></span><span>Introduction to Evolvable APIs</span></a><nav class=""><ul class="sidebar-list sidebar-list-1"><li class="sidebar-item"><a class="sidebar-link " href="/docs/introduction/techniques.html"><span class="sidebar-icon icon-16-flash"></span><span>Foundational techniques to make your APIs evolvable</span></a></li><li class="sidebar-item"><a class="sidebar-link " href="/docs/introduction/versioning.html"><span class="sidebar-icon icon-16-flash"></span><span>Versioning your API contract</span></a></li></ul></nav></li><li class="sidebar-item active"><a class="sidebar-link sidebar-link-selected" href="/docs/recipes/"><span class="sidebar-icon icon-16-streams"></span><span>Recipes (towards Evolvable APIs)</span></a><nav class=""><ul class="sidebar-list sidebar-list-1"><li class="sidebar-item"><a class="sidebar-link " href="/docs/recipes/pagination.html"><span class="sidebar-icon icon-16-flash"></span><span>Pagination</span></a></li><li class="sidebar-item"><a class="sidebar-link " href="/docs/recipes/non-crud-operations.html"><span class="sidebar-icon icon-16-flash"></span><span>Non-CRUD operations</span></a></li><li class="sidebar-item"><a class="sidebar-link " href="/docs/recipes/sparse-fieldsets.html"><span class="sidebar-icon icon-16-flash"></span><span>Sparse Fieldsets</span></a></li><li class="sidebar-item active"><a class="sidebar-link sidebar-link-selected" href="/docs/recipes/resource-embedding.html"><span class="sidebar-icon icon-16-flash"></span><span>Resource embedding</span></a></li></ul></nav></li></ul></nav></div></nav><div class="sidebar-offset"><header class="guide-header"><div class="container-hybrid"><h1 class="title">Resource embedding</h1></div></header><div class="container-hybrid"><div class="docs-guide row"><div class="docs-content col-xs-16 col-md-9"><div class="guide-content"><article id="1"><h2>Context</h2><p>Most of the times, an API models not only a single resource, but a bigger or smaller bunch of them. Thus, there will probably be different endpoints in the API to retrieve or operate with different kind of resources.</p><p>For example, if there is an Endpoint to retrieve information about a member:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="text" ref="code">GET /api/member/15</code></pre></div><p>that will return</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">{
      "gender": "female",
      "alias": "Sophie",
      "name": "Sophia Hart",
      "birthDate": "1975-04-12T00:00Z",
      "email": "sophia.hart@example.com"
}</code></pre></div><p>Let’s suppose that the API provider, also keeps the articles, or blog posts, or short publications (aka micro-posts) that members can write. So, let’s say in this case that there is  another endpoint to return an specific published micro-message:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="text" ref="code">GET /api/posts/42</code></pre></div><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">{
    "articleBody" : "Creating Evolvable APIs is possible. See http://evolvable-apis.org",
    "dateCreated" : "2018-04-12T19:57Z",
    "author" : "15"
}</code></pre></div><p>So, in this case there are two different resources that have some kind of relationship between them: the members create posts, and the posts are authored by a member.</p></article><article id="2"><h2>Need</h2><p>The most probable situation for customers consuming this API will be that they want to show, not only the post content, but also some information about the author (at least the name).</p><p>With the current API design, those customers, will need to make two requests: one for the post and, once the author_id is parsed, another one to retrieve the author name and any other member information useful to show together with the micro-post (i.e the user profile picture).</p><p>The situation gets worse in the case that the endpoint used returns a collection with the latest 50 messages, because you will (in worst case) increase the number of request to 51: one for the collection of messages and then, one for each of the authors of the messages. (You could cache the information of authors in case some messages are written by the same member, but if you have too many different members, you could end up again doing 51 requests to the server).</p></article><article id="3"><h2>Solution</h2><p>We need to address a couple of changes in this context.</p><h3>Step one: Declare relationships between resources.</h3><p>The first task that we should deal with is how we express that the author is a relationship with another entity.</p><p>With the approach shown, there is no way to know that the value of the "author" attribute is an id for another resource represented under other URL. There is no specific info that helps the customer to know if that “15” value is the id, or the name, or an alias, (or any other attribute) from the author. On top of that, there is no specific information on how to access the rest of the information of the author.</p><p>A first idea could be changing the name of the attribute name from "author" to “author_id” to express that this is, in fact, an Id of another resource. But this still does not completely give semantic information on how a client should deal with author Id.</p><p>Instead, we should declare specifically in our contract, that the author is, in fact, a relationship with another resource. For example, <a href="https://tools.ietf.org/html/draft-kelly-json-hal-08#page-4">HAL</a> specification for _links, reserves the attribute "_links" to add all the attributes that are relation types.</p><p>That way, our representation could have this structure:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">{
  "_links" : {
    "author" : { "href" : "http://example.org/api/member/15"}
  },
  "articleBody" : "Creating Evolvable APIs is possible. See http://evolvable-apis.org",
  "dateCreated" : "2018-04-12T19:57Z",
}</code></pre></div><p>Once that the response format includes the specific links, it is also a good practice to introduce a special link, under the attribute of "_self",  which contains the URL to the resource described in the document:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">{
  "_links" : {
    "self" : { "href" : "http://example.org/api/posts/42" },
    "author" : { "href" : "http://example.org/api/member/15" }
  },
  "articleBody" : "Creating Evolvable APIs is possible. See http://evolvable-apis.org",
  "dateCreated" : "2018-04-12T19:57Z",
}</code></pre></div><p>This structure is one possible solution to express relationships between resources as specified by HAL. There are other alternatives following JSON-API, Siren, … follow the format that best fits your needs.</p><h4>Step two: Embed the related resource</h4><p>With the previous step, the relationship for the attribute "author" is more clearly defined and the semantic of how to use that is already defined by the fact that is marked as a link. But, still, the client will need to make a second request to retrieve the details of the member who wrote the message as it is specified in the related URL.</p><p>In order to avoid that second request the API should provide a way to allow the customer to specify the nested information that they are interested in the very first request.</p><p>For that purpose the API implementor should check the query string and look if a ‘includes’ parameter is present. The value of that parameter should be handled by the API provider as a comma-separated list of the different relationships that should be included on the response.</p><p>In the case of the example, to get the message with id 42 including all the information about the author, the customer will simply send the following request:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="text" ref="code">GET /api/posts/42?includes=author</code></pre></div><p>This way, the API provider will know that it needs to also retrieve and return the embedded data for the author. Following the JSON-API format, the provider should add the author data o a new "included" attribute of the Json returned:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">{
  "_links" : {
    "self" : { "href" : "http://example.org/api/posts/42" },
    "author" : { "href" : "http://example.org/api/member/15" }
  },
  "articleBody" : "Creating Evolvable APIs is possible. See http://evolvable-apis.org",
  "dateCreated" : "2018-04-12T19:57Z",
  "_embedded" : {
    "author" : {
      "_links" : {
        "self" :  { "href" : "http://example.org/api/member/15" }
      },
      "id" : "15",
      "gender": "female",
      "alias": "Sophie",
      "name": "Sophia Hart",
      "birthDate": "1975-04-12T00:00Z",
      "email": "sophia.hart@example.com"
    }
  }
}</code></pre></div><h4>Step three: Specifying which attributes of the embedded resource should be included</h4><p>We could go further to allow the customer to specify which fields (attributes) of the embedded resource should be included.</p><p>Combining the embedding with the sparse-fieldset feature, the customer could combine the include and fields param in the query string to whitelist the attributes that should be included in the response.</p><p>By default, as it is explained on the sparse-fieldsets recipe, the values specified in the fields param refers to the main resource requested in the URL, but whe can refer to the embedded resource by adding the entity type between brackets.</p><p>So, a request like</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="text" ref="code">GET /api/posts/42?include=author&amp;fields[person]=name</code></pre></div><p>Instructs the API provider to simply add the name of the embedded resource:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">{
  "_links" : {
    "self" : { "href" : "http://example.org/api/posts/42" },
    "author" : { "href" : "http://example.org/api/member/15" }
  },
  "articleBody" : "Creating Evolvable APIs is possible. See http://evolvable-apis.org",
  "dateCreated" : "2018-04-12T19:57Z",
  "_embedded" : {
    "author" : {
      "_links" : {
        "self" :  { "href" : "http://example.org/api/member/15" }
      },
      "name": "Sophia Hart"
    }
  }
}</code></pre></div><p></p></article><input type="hidden" value="Resource embedding"><input type="hidden" value="Evolvable APIs"></div><div class="contribute"><div class="contribute-img"><span class="icon-16-github"></span></div><div class="contribute-text"><p>Contribute on Github! <a href="https://github.com/liferay/evolvable-apis.org/tree/master/src/pages/docs/recipes/resource-embedding.md" class="contribute-link" target="_blank">Edit this section</a>.</p></div></div></div><nav class="col-xs-16 col-md-offset-2 col-md-5"><div class="docs-nav-container"><div class="affix-top docs-nav"><div ref="readingContainer"></div></div></div></nav></div></div></div></div></main></div></div><script src="/js/bundles/IikRT.js"></script><script>var data = '{"pageLocation":"index.children.docs.children.recipes.children.resource-embedding","site":{"title":"Evolvable APIs","githubRepo":"liferay/evolvable-apis.org","googleAnalytics":"UA-37033501-12","index":{"title":"Home","description":"Embrace rapid evolution without breaking consumers.","srcFilePath":"src/pages/index.soy","id":"pages","location":"/./","url":"/./","children":{"docs":{"title":"Docs","url":"/docs/introduction/index.html","layout":false,"srcFilePath":"src/pages/docs/index.soy","id":"docs","location":"/docs/","customURL":true,"children":{"search":{"description":"Documentation search results.","hidden":true,"title":"Search","srcFilePath":"src/pages/docs/search.soy","id":"search","location":"/docs/search.html","url":"/docs/search.html"},"introduction":{"title":"Introduction to Evolvable APIs","description":"Evolvable REST APIs are specially useful in contexts where the consumers are not written by the same development team as the server side API. Even more so, when the deployment and update of the consumers is specially challenging, as happens with native mobile applications and even more so, consumers present in IoT devices.","layout":"guide","icon":"streams","weight":1,"srcFilePath":"src/pages/docs/introduction/index.md","id":"introduction","location":"/docs/introduction/","url":"/docs/introduction/","children":{"techniques":{"title":"Foundational techniques to make your APIs evolvable","description":"","layout":"guide","icon":"flash","weight":2,"srcFilePath":"src/pages/docs/introduction/techniques.md","id":"techniques","location":"/docs/introduction/techniques.html","url":"/docs/introduction/techniques.html"},"versioning":{"title":"Versioning your API contract","description":"","layout":"guide","icon":"flash","weight":3,"srcFilePath":"src/pages/docs/introduction/versioning.md","id":"versioning","location":"/docs/introduction/versioning.html","url":"/docs/introduction/versioning.html"}},"childIds":["techniques","versioning"]},"recipes":{"title":"Recipes (towards Evolvable APIs)","description":"Making an API Evolvable is about how many different challenges are designed or implemented when we build it. Maybe you do not need to solve all of them for your case. In this section, we will provide some individual recipes on how to address each of this facets.","layout":"guide","icon":"streams","weight":1,"srcFilePath":"src/pages/docs/recipes/index.md","id":"recipes","location":"/docs/recipes/","url":"/docs/recipes/","children":{"non-crud-operations":{"title":"Non-CRUD operations","description":"","layout":"guide","icon":"flash","weight":3,"srcFilePath":"src/pages/docs/recipes/non-crud-operations.md","id":"non-crud-operations","location":"/docs/recipes/non-crud-operations.html","url":"/docs/recipes/non-crud-operations.html"},"pagination":{"title":"Pagination","description":"","layout":"guide","icon":"flash","weight":2,"srcFilePath":"src/pages/docs/recipes/pagination.md","id":"pagination","location":"/docs/recipes/pagination.html","url":"/docs/recipes/pagination.html"},"resource-embedding":{"title":"Resource embedding","description":"","layout":"guide","icon":"flash","weight":4,"srcFilePath":"src/pages/docs/recipes/resource-embedding.md","id":"resource-embedding","location":"/docs/recipes/resource-embedding.html","url":"/docs/recipes/resource-embedding.html","active":true},"sparse-fieldsets":{"title":"Sparse Fieldsets","description":"","layout":"guide","icon":"flash","weight":3,"srcFilePath":"src/pages/docs/recipes/sparse-fieldsets.md","id":"sparse-fieldsets","location":"/docs/recipes/sparse-fieldsets.html","url":"/docs/recipes/sparse-fieldsets.html"}},"childIds":["pagination","non-crud-operations","sparse-fieldsets","resource-embedding"],"active":true}},"childIds":["introduction","recipes","search"],"active":true},"updates":{"title":"Updates","description":"Check out what\'s new","updates":[{"version":"0.0.3","major":true,"features":[{"icon":"code-file","title":"Added \'Recipes\' section.","description":"Recipes section will include small bits of useful help to add to your API features that can help with its evolvability."},{"icon":"code-file","title":"Introduction section in docs.","description":"The Guidelines section have been turned into Introduction section in docs."}]},{"version":"0.0.2","major":true,"features":[{"icon":"flash","title":"Added main information on landing page","description":"First version of the landing page with more info on the main concepts and why Evolvable APIs are needed."},{"icon":"code-file","title":"First draft of the Guidelines","description":"The Guidelines are a set of good practices and advice on what we should take into account in order to make our REST APIs evolvable."}]},{"version":"0.0.1","major":true,"features":[{"icon":"hammer","title":"Very first version of evolvable-apis.org","description":"This version is targeted to very early adopters. API Developers who believe there has to be a better way to do APIs so that they an evolve seamlessly over the years. And who want to participate and make it a reality."}]}],"srcFilePath":"src/pages/updates/index.soy","id":"updates","location":"/updates/","url":"/updates/"}},"childIds":["docs","updates"]},"basePath":"","topbar":[{"href":"/docs/introduction/index.html","label":"Docs","selected":true},{"href":"/updates/","label":"Updates"}]}}'; if (typeof electric !== 'undefined') {electric.init(data);}else {document.addEventListener('DOMContentLoaded', function() {electric.init(data);});}</script></div><script data-senna-track="permanent" src="/js/electric/electric.js"></script></body></html>